---
title: "Tarea 1"
author:
- José Ignacio Rojas Zárate, C16911
- Montserrat Beirute Abarca, C10997
- Valeria Vásquez Venegas, C18373
date: "`r format(Sys.Date(), '%d de %B de %Y', locale = 'es_ES')`"
output:
  pdf_document:
    toc: yes
    latex_engine: xelatex
    number_sections: true
    keep_tex: true
  html_document:
    theme: spacelab
    highlight: arrow
    toc: yes
    toc_float: yes
    lang: es-ES
subtitle: Estadística Actuarial II
header-includes:
  - \usepackage[spanish]{babel}
  - \usepackage{fontspec}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introducción

El presente documento prestan el código y resultados a los ejercicios de la Tarea 1 del curso. Para su realización, se utilizó el programa R studio. 

El presente trabajo utilizó la base de datos "BaseSalarios" brindada por el profesor Esteban Bermúdez Aguilar. 

La base de datos tiene 5 columnas. A continuación, se presentan los primeros seis registros de la base de datos "BaseSalarios" para poder explicar la información de cada columna. 

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
#---Paquetes---------------------------------------------------------

library(stringr) # para cambiar todas las commas a puntos en la columna Ultimo Salario
library(ggplot2) # para hacer los gráficos
library(univariateML) # para hacer el análisis AIC
library(rriskDistributions) # para hacer el análisis AIC
library(boot) # para hacer el bootstrap
library(ks) # para Kernel smoothing
library(knitr) # para presentar mejor los datos en formato tabla
options(scipen = 999) # para que no me salga notacion cientifica
library(cowplot) # para hacer graficos más atractivos
#---CSV y formatos----------------------------------------------------

# Abrir y dar formato a la base de datos

base_salarios <- read.csv("BaseSalarios.csv",  sep = ";")

base_salarios$Fec.Nac <- as.Date(base_salarios$Fec.Nac, format = "%d/%m/%Y")

colnames(base_salarios)[5] ="Ultimo.Salario"

base_salarios <- subset(base_salarios, select = -X)

base_salarios$Ultimo.Salario <- as.numeric(str_replace_all(base_salarios$Ultimo.Salario, ",", "."))

base_salarios_temp <- base_salarios
base_salarios_temp$Ultimo.Salario <- format(base_salarios$Ultimo.Salario, big.mark = " ")

base_salarios_temp2 <- base_salarios


```

```{r, echo=FALSE}
kable(head(base_salarios_temp), caption = "Primeros 6 registros de la base de datos", align = "r") 
```

La columna **ID** cuenta el número de registros disponibles, en este caso, se dispone de 106,002 registros. En la columna **Fec.Nac** se encuentra la información de la fecha de nacimiento de cada persona. En la tercera columna, **Sexo**, se observan los números 1 y 2; específicamente, si el valor de Sexo es 1, corresponde a hombres, y si es 2, corresponde a mujeres. La cuarta columna, **Cuotas** indica la cantidad de cuotas que cada persona ha aportado a un fondo de pensiones. Finalmente, la columna **Ultimo.Salario** contiene el último salario reportado, expresado en colones.  

# Parte I

##  Análisis descriptivo de las variables Cuotas y Salarios con respecto a la variable Sexo

De las 106,002 personas que contiene la base de datos utilizada, el 69.1% son mujeres (73,279 mujeres). Por su parte, el 30.1% restante corresponde a hombres (32,723 hombres).

Es de interés conocer las diferencias o similitudes en los datos del número de cuotas y los salarios según el sexo. 

A continuación, se presenta un cuadro con un resumen estadístico de los datos del número de cuotas para hombres y mujeres.

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

resumen_cuotas_hombres <-summary(base_salarios$Coutas[base_salarios$Sexo == 1])

varianza_cuotas_hombres <- var(base_salarios$Coutas[base_salarios$Sexo == 1])

resumen_cuotas_hombres <- c(resumen_cuotas_hombres, Varianza = varianza_cuotas_hombres)

resumen_cuotas_mujeres <-summary(base_salarios$Coutas[base_salarios$Sexo == 2])

varianza_cuotas_mujeres <- var(base_salarios$Coutas[base_salarios$Sexo == 2])

resumen_cuotas_mujeres <- c(resumen_cuotas_mujeres, Varianza = varianza_cuotas_mujeres)

cuotas_resumen <- data.frame(
  Estadistico = c("Mínimo", "Primer cuartil (Q1)", "Mediana", "Promedio", "Tercer cuartil (Q3)", "Máximo", "Varianza"),
  Hombres = as.numeric(round(resumen_cuotas_hombres,2)),
  Mujeres = as.numeric(round(resumen_cuotas_mujeres,2))
)

```

```{r, echo=FALSE}
kable(cuotas_resumen, caption = "Resumen estadístico de número de coutas por sexo")
```

Como se puede observar, tanto para mujeres como para hombres, el mínimo de cuotas aportadas es tan solo una.

Por su parte, se puede decir que en general las mujeres de la base de datos aportaron más cuotas que los hombres. 

Se puede notar que el 25% de los hombres aportó 61 cuotas o menos, mientras que en el caso de las mujeres, el 25% aportó 66 cuotas o menos.
 
Además, el 50% de las mujeres aportó más de 135 cuotas, mientras que en el caso de los hombres, fue de 124 cuotas.

El promedio de cuotas es más alto para las mujeres (142.97) que para los hombres (135.18). 

También, el 75% de las mujeres aportó 213 cuotas o menos, mientras que en el caso de los hombres, fue de 198 cuotas. 

El valor máximo de cuotas aportadas para las mujeres fue de 373, mientras que para los hombres fue de 371.

Es importante resaltar que para ambos sexos, la varianza indica que los datos están alejados de la media y se presenta mucha variabilidad en los datos de número de cuotas aportadas al fondo de pensiones. 


\newpage

Por otra parte, a continuación, se presenta un cuadro con un resumen estadístico de los datos del último salario reportado para hombres y mujeres.

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

resumen_salarios_hombres <-summary(base_salarios$Ultimo.Salario[base_salarios$Sexo == 1])

varianza_salarios_hombres <- var(base_salarios$Ultimo.Salario[base_salarios$Sexo == 1])

resumen_salarios_hombres <- c(resumen_salarios_hombres, Varianza = varianza_salarios_hombres)

resumen_salarios_mujeres <-summary(base_salarios$Ultimo.Salario[base_salarios$Sexo == 2])

varianza_salarios_mujeres <- var(base_salarios$Ultimo.Salario[base_salarios$Sexo == 2])

resumen_salarios_mujeres <- c(resumen_salarios_mujeres, Varianza = varianza_salarios_mujeres)

salarios_resumen <- data.frame(
  Estadistico = c("Mínimo", "Primer cuartil (Q1)", "Mediana", "Promedio", "Tercer cuartil (Q3)", "Máximo", "Varianza"),
  Hombres = format(as.numeric(round(resumen_salarios_hombres,2)),big.mark = " "),
  Mujeres = format(as.numeric(round(resumen_salarios_mujeres,2))
,big.mark = " "))

```

```{r, echo=FALSE}
kable(salarios_resumen, caption = "Resumen de Último Salario reportado por sexo", align = "r")
```

En el Cuadro 3, se observa que el salario más bajo reportado le pertenece a una mujer, siendo tan solo 656.93 colones menos que el salario más bajo de los hombres. 

En cuanto al Q1, se destaca que el 25% de los hombres tuvieron un último salario reportado de 552,498 colones o menos, mientras que el 25% de las mujeres tuvieron un último salario de 584,757 colones o menos. Es decir, en los últimos salarios más bajos, las mujeres experimentaron ingresos superiores a los de los hombres.

Ahora en relación a la mediana, la mitad de los hombres ganó más de 1,105,231 colones, mientras que la mitad de las mujeres ganó menos (1,046,661 colones). 

Además, el promedio de los últimos salarios fue mayor para los hombres, aproximadamente 110,540 colones más alto.

Las diferencias se incrementan a medida que se consideran los últimos salarios más altos. El 75% de las mujeres ganaron 1 403 025.79 o menos, mientras que el 75% de los hombres ganaron 1 611 786 colones o menos. 

El salario máximo reportado por hombres es 5 909 742 colones más alto que el de las mujeres. 

Es importante resaltar que la varianza para ambos sexos señala que los datos están muy dispersos de la media, es decir hay una gran variabilidad en los datos de último salario reportado. 

\newpage 

## Gráfico plotbox para el salario para comparar entre las categorías de Sexo

El siguiente gráfico plotbox permite tener una representación visual de como se distribuyen los datos para cada sexo. 

```{r, echo=FALSE}
base_salarios_temp2$Sexo <- factor(base_salarios$Sexo, levels = c(1, 2), labels = c("Hombre", "Mujer"))

boxplot_salarios <- ggplot(base_salarios_temp2, aes(x = Sexo, y = Ultimo.Salario, fill = Sexo)) +
  geom_boxplot() +
  theme_cowplot() +
  scale_x_discrete(labels = c("Hombre", "Mujer")) +
  scale_fill_manual(values = c("Hombre" = "lightblue", "Mujer" = "lightgreen")) +
  labs(x = "Sexo", y = "Ultimo salario reportado en miles de colones") +
  scale_y_continuous(breaks = seq(0, 15000000, by = 1000000), labels =   scales::comma_format(scale = 1e-3)) + ggtitle("Boxplot de Ultimo Salario por Sexo")

print(boxplot_salarios)
```

Este gráfico destaca la presencia de salarios atípicos, identificados como aquellos que están fuera de cada una de las cajas. Específicamente, en el caso de los hombres, se observan dos salarios que se encuentran notablemente por encima del resto de los salarios reportados, indicando la presencia de valores atípicos significativos. 

## Conclusiones con respecto a los salarios y sexo

Después de realizar el análisis descriptivo de los datos e interpretar la gráfica de Boxplot, se concluye que al dividir la población por sexo, el 25% de los hombres con los salarios más bajos ganan menos que el 25% de las mujeres con salarios más bajos. Sin embargo, cuando se considera el 50% de los hombres que ganan más, estos perciben un salario mayor que el 50% de las mujeres que ganan más. Esta tendencia se evidencia claramente en el gráfico anterior, donde la parte superior de la caja, que está por encima de la línea de la mediana, es más amplia en el caso de los hombres.


Para respaldar este argumento, se observa que el promedio de los últimos salarios fue mayor para los hombres, aproximadamente 110,540 colones más alto que el de las mujeres.

No obstante, es importante señalar que la varianza de los salarios es mayor para los hombres, y los valores atípicos en los salarios masculinos también son más altos que los de las mujeres.

En este sentido, los salarios de los hombres parecen ser relativamente más altos que los de las mujeres, aunque las diferencias no resultan significativas. 


